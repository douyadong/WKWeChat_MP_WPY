<!--
    @页面名称：经纪人首页
    @作者：豆亚东 (douyadong@lifang.com)
    @业务逻辑说明：
        1.
        2.        
-->
<template lang="wxml">
    <view class="agent">
        <view class="card">
            <image src="{{agentInfo.headRoundImgUrl}}?x-oss-process=image/resize,w_120"  mode="aspectFill" lazy-load="true"></image>
            <view class="agent-info">
                <view class="id-info">
                    <text class="name">{{agentInfo.agentName}}</text>
                    <text class="company">| {{agentInfo.abbreviation}} {{agentInfo.storeName}}</text>
                </view>
                <view class="join-long">入住悟空：{{agentInfo.serviceYears}}</view>
            </view>      
        </view>
        <view class="house-number">TA的房源<text class="number">[{{houseInfo.total}}套]</text></view>
        <view class="house-list">
            <repeat for="{{houseInfo.secondHouseListModels}}" key="index" index="index" item="item">
                <esf :item="item"></esf>
            </repeat>
        </view>
    </view>
    <assistant :agent.sync="agentInfo"></assistant>
</template>

<script>
    import wepy from "wepy";
    import Esf from "../../components/esf";
    import Assistant from "../../components/assistant";
    import apiDataFilter from "../../mixins/apiDataFilter";
    export default class Index extends wepy.page {
        config = {
            
        };
        components = {
            esf: Esf,
            assistant: Assistant
        };
        data = {
            agentInfo: '',//经纪人身份信息;
            houseInfo:'',//房源列表信息;
            pageInfo:{
                    pageIndex:0,//评论的起始条数
                    pageSize:20,//评论信息每次加载多少条
                    total:0
            }
        };
        computed = {

        };
        methods = {

        };
        events = {

        };
        onLoad(options) {
            let self=this;
            //经济人身份信息;
            apiDataFilter.request({
                apiPath : "agent.index" ,
                data : { "agentId":100632 } ,
                successCallback:function(res){
                    self.agentInfo=res.data;
                    self.$apply();
                    console.log(self.agentInfo);
                     //动态改变页面title;
                    wx.setNavigationBarTitle({title:self.agentInfo.agentName+'的名片'});
                }
            });
            //页面刚开始加载时获取的房源列表信息;
            apiDataFilter.request({
                apiPath : "agent.house" ,
                data : { 
                    "agentId":100632 ,
                    "pageIndex":self.pageInfo.pageIndex,
                    "pageSize":self.pageInfo.pageSize, 
                    } ,
                successCallback:function(res){
                    console.log(res);
                    self.houseInfo=res.data;
                    self.pageInfo.pageIndex += (res.secondHouseListModels&& res.secondHouseListModels.length || 0);
                    self.$apply();
                }
            })
        };
        onReachBottom() {
            // 页面上拉触发该函数用于滚动加载数据
            //经纪人房源信息;
            let self=this;
            apiDataFilter.request({
                apiPath : "agent.house",
                data : { 
                    "agentId":100632,
                    "pageIndex":self.pageInfo.pageIndex,
                    "pageSize":self.pageInfo.pageSize, 
                    } ,
                successCallback:function(res){
                    if(res.data.secondHouseListModels){
                        self.houseInfo.secondHouseListModels= self.houseInfo.secondHouseListModels.concat(res.data.secondHouseListModels);
                        self.pageInfo.pageIndex += (res.data.secondHouseListModels&& res.data.secondHouseListModels.length || 0);
                        self.$apply();
                    }   
                }
            })
        }
    }
</script>

<style lang="less" scoped>
    @import "../../less/variables.less";
    @import "../../less/mixins.less"; 
    // 经纪人信息;
    .agent {
        background-color: #fff;
        padding-bottom: 130rpx;
        .card {
            border-bottom: 1rpx solid #d8d8d8;
            .clearfix();
            padding: 30rpx;
            image {
                float: left;
                height: 120rpx;
                width: 120rpx;
            }
            .agent-info {
                margin-left: 150rpx;
                .id-info {
                    font-size: 32rpx;
                    margin-bottom: 22rpx;
                    .name {
                        margin-right: 20rpx;
                    }
                    .company {
                        color: @lighter-font-color;
                    }
                }
                .join-long {
                    color: @lighter-font-color;
                    font-size: 28rpx;
                }
            }
        } 
        // 经纪人有多少房源
        .house-number {
            font-size: 32rpx;
            margin-top: 30rpx;
            padding: 0 30rpx;
            .number {
                color: @lighter-font-color;
            }
        } 
        // 房源列表;
        .house-list {
            // .clearfix();
            padding-left: 30rpx;
        }
    }
</style>